<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="免流常见原理1、修改HTTP连接header:这里需要了解运营商如何分辨手机走的流量是否为免流流量,目前采用的多是检查HTTP header,查看是否是指定的Host、UA等,具体免流方法为将手机流量中,每一个HTTP请求中,均加入能够免流的Host、UA、或者其他一些免流参数即可.">
<meta property="og:type" content="article">
<meta property="og:title" content="深入分析免流">
<meta property="og:url" content="http://yoursite.com/2016/10/28/28.html">
<meta property="og:site_name" content="免费资源分享">
<meta property="og:description" content="免流常见原理1、修改HTTP连接header:这里需要了解运营商如何分辨手机走的流量是否为免流流量,目前采用的多是检查HTTP header,查看是否是指定的Host、UA等,具体免流方法为将手机流量中,每一个HTTP请求中,均加入能够免流的Host、UA、或者其他一些免流参数即可.">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/871e88b0gw1f7pqq9n46qj21401z4kd0.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/large/871e88b0gw1f7pr0pljwgj21401z4dvs.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/871e88b0gw1f7prerdozgj21401z4k9p.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/871e88b0gw1f7tgrmvmv5j20bi023aad.jpg">
<meta property="og:updated_time" content="2016-11-01T11:35:25.870Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入分析免流">
<meta name="twitter:description" content="免流常见原理1、修改HTTP连接header:这里需要了解运营商如何分辨手机走的流量是否为免流流量,目前采用的多是检查HTTP header,查看是否是指定的Host、UA等,具体免流方法为将手机流量中,每一个HTTP请求中,均加入能够免流的Host、UA、或者其他一些免流参数即可.">
<meta name="twitter:image" content="http://ww3.sinaimg.cn/large/871e88b0gw1f7pqq9n46qj21401z4kd0.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6347928475260683000',
      author: '博主大人'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/10/28/28.html"/>


  <title> 深入分析免流 | 免费资源分享 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?5e4566013c7bbd72d3e4f7977d4fd431";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">免费资源分享</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                深入分析免流
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-28T08:56:41+08:00" content="2016-10-28">
              2016-10-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/4G免流/" itemprop="url" rel="index">
                    <span itemprop="name">4G免流</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/28/28.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/28/28.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="免流常见原理"><a href="#免流常见原理" class="headerlink" title="免流常见原理"></a>免流常见原理</h2><p>1、修改HTTP连接header:<br>这里需要了解运营商如何分辨手机走的流量是否为免流流量,目前采用的多是检查HTTP header,查看是否是指定的Host、UA等,具体免流方法为将手机流量中,每一个HTTP请求中,均加入能够免流的Host、UA、或者其他一些免流参数即可.<br><a id="more"></a><br>2、指定端口免流:<br>这个是比较早期的免流方法,目前在大多数地区均不可用,原理为使用ss、vpn等工具,通过指定的端口,如137/138/139等端口,即可免流.</p>
<p><code>注：此方法中使用的免流代码已失效</code></p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>1、找到一款能够免流量费用的软件(直接使用即可免流量或者开通指定套餐免流量均可),或者网址.<br>我这里找到的是咪咕音乐<br>介绍中写了有免流量,实际测试发现确实是免流量的.<br><a href="http://ww3.sinaimg.cn/large/871e88b0gw1f7pqq9n46qj21401z4kd0.jpg" target="_blank" rel="external"><img src="http://ww3.sinaimg.cn/large/871e88b0gw1f7pqq9n46qj21401z4kd0.jpg" alt="http://ww3.sinaimg.cn/large/871e88b0gw1f7pqq9n46qj21401z4kd0.jpg"></a></p>
<p>2、抓取数据包,打开咪咕音乐,播放音乐,使用wi.cap进行抓包,结果如图所示.<br><a href="http://ww2.sinaimg.cn/large/871e88b0gw1f7pr0pljwgj21401z4dvs.jpg" target="_blank" rel="external"><img src="http://ww2.sinaimg.cn/large/871e88b0gw1f7pr0pljwgj21401z4dvs.jpg" alt="http://ww2.sinaimg.cn/large/871e88b0gw1f7pr0pljwgj21401z4dvs.jpg"></a></p>
<p>可以看到有Host、Accept、User-Agent、Connection、imei、imsi等header.</p>
<p>3、使用可以手工构造HTTP header的,类似于HTTP/HTTPS协议的vpn软件,如openvpn、ssr等,这里我使用的是ssr.<br>搭建ssr服务器,搭建时注意ss服务器端口和咪咕音乐服务器端口一致,这里是80端口,协议选择auth_sha1,混淆方式使用http_simple.<br>这里我使用了一段网上搭建ssr的脚本,可以直接<code>wget http://vpn.ximcx.cn/SSR/SSR &amp;amp; bash SSR</code>使用.<br>脚本内容为</p>
<div style="overflow: scroll; width: 800px; height: 300px;">

<pre><code>#! /bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
#=================================================================#
#   System Required:  CentOS 6,7, Debian, Ubuntu                   #
#   Description: One click Install ShadowsocksR Server              #
#   Author: 91yun                                                              #
#   Thanks: @breakwa11 &amp;lt;https://twitter.com/breakwa11&amp;gt;       #
#   Thanks: @Teddysun &amp;lt;i@teddysun.com&amp;gt;                            #
#   Intro:  https://shadowsocks.be/9.html                              #
#=================================================================#
rm -f SSR
clear
yum -y install git
echo -e &quot;\033[34m================================================================\033[0m

\033[31m                欢迎使用SSR免流Or翻墙一键脚本                         \033[0m

\033[31m         妖火网论坛：http://yaohuo.me，I&apos;M 西门吹雪             \033[0m

\033[31m           即将开始搭建...   非妖火论坛妖友使用死全家                  \033[0m
\033[34m================================================================\033[0m&quot;;
echo

echo

#Current folder
cur_dir=`pwd`
# Get public IP address
IP=$(ip addr | egrep -o &apos;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&apos; | egrep -v &quot;^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\.&quot; | head -n 1)
if [[ &quot;$IP&quot; = &quot;&quot; ]]; then
    IP=$(wget -qO- -t1 -T2 ipv4.icanhazip.com)
fi

# Make sure only root can run our script
function rootness(){
    if [[ $EUID -ne 0 ]]; then
       echo &quot;Error:This script must be run as root!&quot; 1&amp;gt;&amp;amp;2
       exit 1
    fi
}

# Check OS
function checkos(){
    if [ -f /etc/redhat-release ];then
        OS=&apos;CentOS&apos;
    elif [ ! -z &quot;`cat /etc/issue | grep bian`&quot; ];then
        OS=&apos;Debian&apos;
    elif [ ! -z &quot;`cat /etc/issue | grep Ubuntu`&quot; ];then
        OS=&apos;Ubuntu&apos;
    else
        echo &quot;Not support OS, Please reinstall OS and retry!&quot;
        exit 1
    fi
}

# Get version
function getversion(){
    if [[ -s /etc/redhat-release ]];then
        grep -oE  &quot;[0-9.]+&quot; /etc/redhat-release
    else    
        grep -oE  &quot;[0-9.]+&quot; /etc/issue
    fi    
}

# CentOS version
function centosversion(){
    local code=$1
    local version=&quot;`getversion`&quot;
    local main_ver=${version%%.*}
    if [ $main_ver == $code ];then
        return 0
    else
        return 1
    fi        
}

# Disable selinux
function disable_selinux(){
if [ -s /etc/selinux/config ] &amp;amp;&amp;amp; grep &apos;SELINUX=enforcing&apos; /etc/selinux/config; then
    sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/g&apos; /etc/selinux/config
    setenforce 0
fi
}

# Pre-installation settings
function pre_install(){
    # Not support CentOS 5
    if centosversion 5; then
        echo &quot;Not support CentOS 5, please change OS to CentOS 6+/Debian 7+/Ubuntu 12+ and retry.&quot;
        exit 1
    fi
    # Set ShadowsocksR config password
    echo &quot;请输入SSR连接密码:&quot;
    read -p &quot;(默认密码: yaohuo520):&quot; shadowsockspwd
    [ -z &quot;$shadowsockspwd&quot; ] &amp;amp;&amp;amp; shadowsockspwd=&quot;yaohuo520&quot;
    echo
    echo &quot;---------------------------&quot;
    echo &quot;password = $shadowsockspwd&quot;
    echo &quot;---------------------------&quot;
    echo
    # Set ShadowsocksR config port
    while true
    do
    echo -e &quot;请输入SSR连接端口,不设置将默认138端口:&quot;
    read -p &quot;(默认自动设置SS免流端口为138):&quot; shadowsocksport
    [ -z &quot;$shadowsocksport&quot; ] &amp;amp;&amp;amp; shadowsocksport=&quot;138&quot;
    expr $shadowsocksport + 0 &amp;amp;&amp;gt;/dev/null
    if [ $? -eq 0 ]; then
        if [ $shadowsocksport -ge 1 ] &amp;amp;&amp;amp; [ $shadowsocksport -le 65535 ]; then
            echo
            echo &quot;---------------------------&quot;
            echo &quot;port = $shadowsocksport&quot;
            echo &quot;---------------------------&quot;
            echo
            break
        else
            echo &quot;输入错误，请输入1-65535之间的数字！&quot;
        fi
    else
        echo &quot;输入错误，请输入1-65535之间的数字！&quot;
    fi
    done
    get_char(){
        SAVEDSTTY=`stty -g`
        stty -echo
        stty cbreak
        dd if=/dev/tty bs=1 count=1 2&amp;gt; /dev/null
        stty -raw
        stty echo
        stty $SAVEDSTTY
    }
    echo
    echo &quot;Press any key to start...or Press Ctrl+C to cancel&quot;
    char=`get_char`
    # Install necessary dependencies
    if [ &quot;$OS&quot; == &apos;CentOS&apos; ]; then
        yum install -y wget unzip openssl-devel gcc swig python python-devel python-setuptools autoconf libtool libevent git ntpdate
        yum install -y m2crypto automake make curl curl-devel zlib-devel perl perl-devel cpio expat-devel gettext-devel
    else
        apt-get -y update
        apt-get -y install python python-dev python-pip python-m2crypto curl wget unzip gcc swig automake make perl cpio build-essential git ntpdate
    fi
    cd $cur_dir
}

# Download files
function download_files(){
    # Download libsodium file
    if ! wget --no-check-certificate -O libsodium-1.0.10.tar.gz https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz; then
        echo &quot;Failed to download libsodium file!&quot;
        exit 1
    fi
    # Download ShadowsocksR file
    # if ! wget --no-check-certificate -O manyuser.zip https://github.com/breakwa11/shadowsocks/archive/manyuser.zip; then
        # echo &quot;Failed to download ShadowsocksR file!&quot;
        # exit 1
    # fi
    # Download ShadowsocksR chkconfig file
    if [ &quot;$OS&quot; == &apos;CentOS&apos; ]; then
        if ! wget --no-check-certificate https://raw.githubusercontent.com/91yun/shadowsocks_install/master/shadowsocksR -O /etc/init.d/shadowsocks; then
            echo &quot;Failed to download ShadowsocksR chkconfig file!&quot;
            exit 1
        fi
    else
        if ! wget --no-check-certificate https://raw.githubusercontent.com/91yun/shadowsocks_install/master/shadowsocksR-debian -O /etc/init.d/shadowsocks; then
            echo &quot;Failed to download ShadowsocksR chkconfig file!&quot;
            exit 1
        fi
    fi
}

# firewall set
function firewall_set(){
    echo &quot;firewall set start...&quot;
    if centosversion 6; then
        /etc/init.d/iptables status &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
        if [ $? -eq 0 ]; then
            iptables -L -n | grep &apos;${shadowsocksport}&apos; | grep &apos;ACCEPT&apos; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
            if [ $? -ne 0 ]; then
                iptables -I INPUT -m state --state NEW -m tcp -p tcp --dport ${shadowsocksport} -j ACCEPT
                iptables -I INPUT -m state --state NEW -m udp -p udp --dport ${shadowsocksport} -j ACCEPT
                /etc/init.d/iptables save
                /etc/init.d/iptables restart
            else
                echo &quot;port ${shadowsocksport} has been set up.&quot;
            fi
        else
            echo &quot;WARNING: iptables looks like shutdown or not installed, please manually set it if necessary.&quot;
        fi
    elif centosversion 7; then
        systemctl status firewalld &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
        if [ $? -eq 0 ];then
            firewall-cmd --permanent --zone=public --add-port=${shadowsocksport}/tcp
            firewall-cmd --permanent --zone=public --add-port=${shadowsocksport}/udp
            firewall-cmd --reload
        else
            echo &quot;Firewalld looks like not running, try to start...&quot;
            systemctl start firewalld
            if [ $? -eq 0 ];then
                firewall-cmd --permanent --zone=public --add-port=${shadowsocksport}/tcp
                firewall-cmd --permanent --zone=public --add-port=${shadowsocksport}/udp
                firewall-cmd --reload
            else
                echo &quot;WARNING: Try to start firewalld failed. please enable port ${shadowsocksport} manually if necessary.&quot;
            fi
        fi
    fi
    echo &quot;firewall set completed...&quot;
}

# Config ShadowsocksR
function config_shadowsocks(){
    cat &amp;gt; /etc/shadowsocks.json&amp;lt;&amp;lt;-EOF
{
    &quot;server&quot;: &quot;0.0.0.0&quot;,
    &quot;server_ipv6&quot;: &quot;::&quot;,
    &quot;server_port&quot;: ${shadowsocksport},
    &quot;local_address&quot;: &quot;127.0.0.1&quot;,
    &quot;local_port&quot;: 1081,
    &quot;password&quot;: &quot;${shadowsockspwd}&quot;,
    &quot;timeout&quot;: 120,
    &quot;udp_timeout&quot;: 60,
    &quot;method&quot;: &quot;chacha20&quot;,
    &quot;protocol&quot;: &quot;auth_sha1_compatible&quot;,
    &quot;protocol_param&quot;: &quot;&quot;,
    &quot;obfs&quot;: &quot;http_simple_compatible&quot;,
    &quot;obfs_param&quot;: &quot;&quot;,
    &quot;dns_ipv6&quot;: false,
    &quot;connect_verbose_info&quot;: 0,
    &quot;redirect&quot;: &quot;&quot;,
    &quot;fast_open&quot;: false,
    &quot;workers&quot;: 1

}
EOF
}

# Install ShadowsocksR
function install_ss(){
    # Install libsodium
    tar zxf libsodium-1.0.10.tar.gz
    cd $cur_dir/libsodium-1.0.10
    ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install
    echo &quot;/usr/local/lib&quot; &amp;gt; /etc/ld.so.conf.d/local.conf
    ldconfig
    # Install ShadowsocksR
    cd $cur_dir
    # unzip -q manyuser.zip
    # mv shadowsocks-manyuser/shadowsocks /usr/local/
    git clone -b manyuser https://github.com/breakwa11/shadowsocks.git /usr/local/shadowsocks
    if [ -f /usr/local/shadowsocks/server.py ]; then
        chmod +x /etc/init.d/shadowsocks
        # Add run on system start up
        if [ &quot;$OS&quot; == &apos;CentOS&apos; ]; then
            chkconfig --add shadowsocks
            chkconfig shadowsocks on
        else
            update-rc.d -f shadowsocks defaults
        fi
        # Run ShadowsocksR in the background
        /etc/init.d/shadowsocks start
        clear
        echo
        echo &quot;恭喜你，shadowsocksr安装完成！&quot;
        echo -e &quot;服务器IP: \033[41;37m ${IP} \033[0m&quot;
        echo -e &quot;远程连接端口: \033[41;37m ${shadowsocksport} \033[0m&quot;
        echo -e &quot;远程连接密码: \033[41;37m ${shadowsockspwd} \033[0m&quot;
        echo -e &quot;本地监听IP: \033[41;37m 127.0.0.1 \033[0m&quot;
        echo -e &quot;本地监听端口: \033[41;37m 1080 \033[0m&quot;
        echo -e &quot;认证方式: \033[41;37m auth_sha1 \033[0m&quot;
        echo -e &quot;协议: \033[41;37m http_simple \033[0m&quot;
        echo -e &quot;加密方式: \033[41;37m chacha20 \033[0m&quot;
        echo
        echo &quot;欢迎来访妖火论坛:http://yaohuo.me Or https://yaohw.com&quot;
        echo &quot;如果你想改变认证方式和协议，请参考网址&quot;
        echo &quot;https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup&quot;
        echo
        echo &quot;安装完毕！去享受这种愉悦感把！I&apos;m your old friend 西门吹雪&quot;
        echo
    else
        echo &quot;Shadowsocks安装失败!&quot;
        install_cleanup
        exit 1
    fi
}

#改成北京时间
function check_datetime(){
    rm -rf /etc/localtime
    ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
    ntpdate 1.cn.pool.ntp.org
}

# Install cleanup
function install_cleanup(){
    cd $cur_dir
    rm -f manyuser.zip
    rm -rf shadowsocks-manyuser
    rm -f libsodium-1.0.10.tar.gz
    rm -rf libsodium-1.0.10
}

# Uninstall ShadowsocksR
function uninstall_shadowsocks(){
    printf &quot;你确定卸载shadowsocksr？ (y/n) &quot;
    printf &quot;\n&quot;
    read -p &quot;(Default: n):&quot; answer
    if [ -z $answer ]; then
        answer=&quot;n&quot;
    fi
    if [ &quot;$answer&quot; = &quot;y&quot; ]; then
        /etc/init.d/shadowsocks status &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
        if [ $? -eq 0 ]; then
            /etc/init.d/shadowsocks stop
        fi
        checkos
        if [ &quot;$OS&quot; == &apos;CentOS&apos; ]; then
            chkconfig --del shadowsocks
        else
            update-rc.d -f shadowsocks remove
        fi
        rm -f /etc/shadowsocks.json
        rm -f /etc/init.d/shadowsocks
        rm -rf /usr/local/shadowsocks
        echo &quot;ShadowsocksR uninstall success!&quot;
    else
        echo &quot;uninstall cancelled, Nothing to do&quot;
    fi
}

# Install ShadowsocksR
function install_shadowsocks(){
    checkos
    rootness
    disable_selinux
    pre_install
    download_files
    config_shadowsocks
    install_ss
    if [ &quot;$OS&quot; == &apos;CentOS&apos; ]; then
        firewall_set &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
    fi
    check_datetime
    install_cleanup

}

# Initialization step
action=$1
[ -z $1 ] &amp;amp;&amp;amp; action=install
case &quot;$action&quot; in
install)
    install_shadowsocks
    ;;
uninstall)
    uninstall_shadowsocks
    ;;
*)
    echo &quot;Arguments error! [${action} ]&quot;
    echo &quot;Usage: `basename $0` {install|uninstall}&quot;
    ;;
esac
`&lt;/pre&gt;
&lt;/div&gt;
4、搭建好后在手机端进行设置.
如图:
[![http://ww4.sinaimg.cn/large/871e88b0gw1f7prc6wdo8j21401z4tf4.jpg](http://ww4.sinaimg.cn/large/871e88b0gw1f7prc6wdo8j21401z4tf4.jpg)](http://ww4.sinaimg.cn/large/871e88b0gw1f7prc6wdo8j21401z4tf4.jpg)

[![http://ww2.sinaimg.cn/large/871e88b0gw1f7prcpkhcxj21401z447y.jpg](http://ww2.sinaimg.cn/large/871e88b0gw1f7prcpkhcxj21401z447y.jpg)](http://ww2.sinaimg.cn/large/871e88b0gw1f7prcpkhcxj21401z447y.jpg)

使用的混淆代码如下
`freetyst.mll.migu.cn\r\nAccept: */*\r\nUser-Agent: migumusic\r\nConnection: close\r\nimei: 000000000000000000\r\nimsi: 00000000000000000000`
(已手工马赛克)

使用openvpn的话，免流代码如下
&lt;pre&gt;`http-proxy-option EXT1 &quot;GET http://migumovie.lovev.com&quot;
http-proxy-option EXT1 &quot;Host: freetyst.mll.migu.cn&quot;
http-proxy-option EXT1 &quot;Accept: */*&quot;
http-proxy-option EXT1 &quot;User-Agent: migumusic&quot;
http-proxy-option EXT1 &quot;Connection: close&quot;
http-proxy 10.0.0.172 80
</code></pre><p>最后的10.0.0.172 80是移动的HTTP代理服务器,也可以自己搭建HTTP代理服务器,然后修改10.0.0.172为自己的代理服务器</p>
<p>5、手机上开启ss，抓包查看<br><a href="http://ww1.sinaimg.cn/large/871e88b0gw1f7prerdozgj21401z4k9p.jpg" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/large/871e88b0gw1f7prerdozgj21401z4k9p.jpg" alt="http://ww1.sinaimg.cn/large/871e88b0gw1f7prerdozgj21401z4k9p.jpg"></a></p>
<p>移动网上营业厅截图<br><a href="http://ww4.sinaimg.cn/large/871e88b0gw1f7tgrmvmv5j20bi023aad.jpg" target="_blank" rel="external"><img src="http://ww4.sinaimg.cn/large/871e88b0gw1f7tgrmvmv5j20bi023aad.jpg" alt="http://ww4.sinaimg.cn/large/871e88b0gw1f7tgrmvmv5j20bi023aad.jpg"></a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这里免流的核心其实就是找到一个移动运营商允许的可以免流量使用的软件<br>而手机流量通过移动运行商时,移动运行商会检查数据包中有没有不收取流量的数据包<br>检查方法基本是使用的HTTP header中的关键字<br>因此,只需要找到检测的关键字,把手机上发出的每一个数据包都带上这个关键字,就可以免流了<br>同理,如果需要手机开热点出来给电脑用,也是一样的,只要发出的数据包带有这个关键字,就能免流<br>以上方法为HTTP协议的免流,如果发现某个软件使用的tcp等协议,也可以分析包里的特征,实现免流<br>如果使用的免流服务器为国外的服务器，当流量太大时,可能会被gfw干掉,另外据说有人使用国外服务器免流,被运营商发现过,真伪未知</p>
</div>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat.jpg" alt="home again WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.jpg" alt="home again Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/28/26.html" rel="next" title="免费的 docker 容器运行服务，支持 TCP 监听">
                <i class="fa fa-chevron-left"></i> 免费的 docker 容器运行服务，支持 TCP 监听
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/28/30.html" rel="prev" title="送office365教育版公用账号">
                送office365教育版公用账号 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/10/28/28.html"
           data-title="深入分析免流" data-url="http://yoursite.com/2016/10/28/28.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="home again" />
          <p class="site-author-name" itemprop="name">home again</p>
          <p class="site-description motion-element" itemprop="description">世界上有不绝的风景,我有不老的心情</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">53</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#免流常见原理"><span class="nav-number">1.</span> <span class="nav-text">免流常见原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实战"><span class="nav-number">2.</span> <span class="nav-text">实战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">home again</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mvper"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

  


</body>
</html>
